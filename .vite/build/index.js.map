{"version":3,"file":"index.js","sources":["../../src/preload/index.ts"],"sourcesContent":["import { contextBridge, ipcRenderer } from 'electron';\r\n\r\n/**\r\n * Type definitions for IPC arguments and responses.\r\n */\r\ninterface ScanArgs {\r\n  source: string;\r\n  dest: string;\r\n  rootOnly: boolean;\r\n}\r\n\r\ninterface TreeNode {\r\n  path: string;\r\n  name: string;\r\n  isDir: boolean;\r\n  state: string;\r\n  hasChildren: boolean;\r\n  modeAtPath: string;\r\n}\r\n\r\ninterface ScanStats {\r\n  directoriesScanned: number;\r\n  ruleFilesFound: number;\r\n  conflictsFound: number;\r\n}\r\n\r\ninterface ScanResponse {\r\n  scanId: string;\r\n  conflicts: string[];\r\n  rootNode: TreeNode;\r\n  stats: ScanStats;\r\n}\r\n\r\ninterface ListChildrenArgs {\r\n  scanId: string;\r\n  dirPath: string;\r\n}\r\n\r\ninterface ListChildrenResponse {\r\n  children: TreeNode[];\r\n}\r\n\r\ninterface ExplainArgs {\r\n  scanId: string;\r\n  nodePath: string;\r\n}\r\n\r\ninterface PatternEntry {\r\n  patternText: string;\r\n  lineNumber: number;\r\n  ruleFilePath: string;\r\n}\r\n\r\ninterface ExplainData {\r\n  path: string;\r\n  name: string;\r\n  decision: string;\r\n  mode: string;\r\n  ruleChain: string[];\r\n  matchingPatterns: PatternEntry[];\r\n}\r\n\r\ninterface ExplainResponse {\r\n  explain: ExplainData;\r\n}\r\n\r\ninterface JobPlanOptions {\r\n  scanId: string;\r\n  rootOnly?: boolean;\r\n}\r\n\r\ninterface RobocopyJob {\r\n  jobId: string;\r\n  srcRoot: string;\r\n  dstRoot: string;\r\n  mode: string;\r\n  patterns: PatternEntry[];\r\n  originRuleFiles: string[];\r\n}\r\n\r\ninterface JobPlan {\r\n  planId: string;\r\n  sourceRoot: string;\r\n  destRoot: string;\r\n  jobs: RobocopyJob[];\r\n  totalJobs: number;\r\n}\r\n\r\ninterface DryRunReport {\r\n  plan: JobPlan;\r\n  validPlan: boolean;\r\n  conflicts: string[];\r\n  estimatedFiles?: number;\r\n  estimatedBytes?: number;\r\n}\r\n\r\ninterface DryRunResponse {\r\n  success: boolean;\r\n  report?: DryRunReport;\r\n  error?: string;\r\n}\r\n\r\ninterface CopyResponse {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\ninterface CancelResponse {\r\n  success: boolean;\r\n  error?: string;\r\n}\r\n\r\ntype CopyEventListener = (data: any) => void;\r\n\r\n/**\r\n * Exposes a safe API to the renderer process via contextBridge.\r\n * The renderer accesses these methods via `window.electronAPI`.\r\n */\r\ncontextBridge.exposeInMainWorld('electronAPI', {\r\n  selectFolder: (args: { kind: string }): Promise<{ path: string | null }> =>\r\n    ipcRenderer.invoke('selectFolder', args),\r\n\r\n  selectDirectory: (args: { title: string }): Promise<{ path: string | null }> =>\r\n    ipcRenderer.invoke('selectDirectory', args),\r\n\r\n  selectFiles: (args: { title: string; multi: boolean }): Promise<{ success: boolean; filePaths: string[]; error?: string }> =>\r\n    ipcRenderer.invoke('selectFiles', args),\r\n\r\n  getDefaultRuleFilePath: (args: { folderPath: string; ruleType: 'copyignore' | 'copyinclude' }): Promise<{ filePath: string }> =>\r\n    ipcRenderer.invoke('getDefaultRuleFilePath', args),\r\n\r\n  openRuleFileDialog: (): Promise<any> =>\r\n    ipcRenderer.invoke('openRuleFileDialog'),\r\n\r\n  showSaveRuleFileDialog: (args: { ruleType: 'copyignore' | 'copyinclude'; defaultDir?: string }): Promise<{ filePath: string | null }> =>\r\n    ipcRenderer.invoke('showSaveRuleFileDialog', args),\r\n\r\n  checkRuleFileSave: (args: { targetPath: string; ruleType: 'copyignore' | 'copyinclude' }): Promise<any> =>\r\n    ipcRenderer.invoke('checkRuleFileSave', args),\r\n\r\n  writeRuleFile: (args: { targetPath: string; ruleType: 'copyignore' | 'copyinclude'; content: string; overwriteExisting: boolean; allowConflict: boolean }): Promise<any> =>\r\n    ipcRenderer.invoke('writeRuleFile', args),\r\n\r\n  hasOpenAIApiKey: (): Promise<{ hasKey: boolean }> =>\r\n    ipcRenderer.invoke('hasOpenAIApiKey'),\r\n\r\n  setOpenAIApiKey: (args: { apiKey: string }): Promise<{ success: boolean; error?: string }> =>\r\n    ipcRenderer.invoke('setOpenAIApiKey', args),\r\n\r\n  clearOpenAIApiKey: (): Promise<{ success: boolean; error?: string }> =>\r\n    ipcRenderer.invoke('clearOpenAIApiKey'),\r\n\r\n  generateRulesWithOpenAI: (args: { model: string; ruleType: 'copyignore' | 'copyinclude'; instruction: string; currentText: string; filePaths: string[]; includeFileContents: boolean; folderStructure?: string }): Promise<any> =>\r\n    ipcRenderer.invoke('generateRulesWithOpenAI', args),\r\n\r\n  scanFolderForAI: (args: { folderPath: string; recursive: boolean }): Promise<any> =>\r\n    ipcRenderer.invoke('scanFolderForAI', args),\r\n  \r\n  scan: (args: ScanArgs): Promise<ScanResponse> =>\r\n    ipcRenderer.invoke('scan', args),\r\n  \r\n  listChildren: (args: ListChildrenArgs): Promise<ListChildrenResponse> =>\r\n    ipcRenderer.invoke('listChildren', args),\r\n  \r\n  explain: (args: ExplainArgs): Promise<ExplainResponse> =>\r\n    ipcRenderer.invoke('explain', args),\r\n  \r\n  openInExplorer: (args: { dirPath: string }): Promise<{ success: boolean }> =>\r\n    ipcRenderer.invoke('openInExplorer', args),\r\n  \r\n  copyToClipboard: (args: { text: string }): Promise<{ success: boolean }> =>\r\n    ipcRenderer.invoke('copyToClipboard', args),\r\n  \r\n  dryRun: (args: JobPlanOptions): Promise<DryRunResponse> =>\r\n    ipcRenderer.invoke('dryRun', args),\r\n  \r\n  copy: (args: JobPlanOptions): Promise<CopyResponse> =>\r\n    ipcRenderer.invoke('copy', args),\r\n  \r\n  cancel: (): Promise<CancelResponse> =>\r\n    ipcRenderer.invoke('cancel'),\r\n  \r\n  // Event listeners for copy progress\r\n  onCopyStatus: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:status', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:status', listener);\r\n  },\r\n  \r\n  onCopyJobStart: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:jobStart', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:jobStart', listener);\r\n  },\r\n  \r\n  onCopyJobEnd: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:jobEnd', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:jobEnd', listener);\r\n  },\r\n  \r\n  onCopyLogLine: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:logLine', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:logLine', listener);\r\n  },\r\n  \r\n  onCopyDone: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:done', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:done', listener);\r\n  },\r\n  \r\n  onCopyError: (listener: CopyEventListener) => {\r\n    ipcRenderer.on('copy:error', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('copy:error', listener);\r\n  },\r\n\r\n  // Menu action listener\r\n  onMenuAction: (listener: (data: { action: string; message?: string }) => void) => {\r\n    ipcRenderer.on('menu-action', (_event, data) => listener(data));\r\n    return () => ipcRenderer.removeListener('menu-action', listener);\r\n  },\r\n});\r\n"],"names":["contextBridge","ipcRenderer"],"mappings":"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"}